$[ language java ]
$[ domain Repository ]
$[ D "The purpose of this code is to create Repository code that fetches from the database field" ]
$[ D "from both the object and version entity - with respect to a release - so as to unify that data." ]
$[ D "This will allow clients to have all the data for a release without having to know about" ]
$[ D "revisioning." ]

$[ author to org.entityc.springboot.repository.get ]
    $[ author to outlet methods scope = publisher
       D "Adds methods for the generation of object-version data unification with respect to a"
       D "release."
    ]
        $[ if entity.hasTag("release:binder") ]
            $[ let binderEntity = entity ]
            $[ call getReleaseBinderRelationships(versionReleaseEntity: binderEntity)->(results: results) ]
            $[ if results != null && results.count > 2 ]
                $[ let topRelationship = results.get(0) ]
                $[ let objectRelationship = results.get(1) ]
                $[ let versionRelationship = results.get(2) ]
                $[ let topEntity = topRelationship.to.entity ]
                $[ let topPKColumnName = topEntity.primaryKeyAttribute|domain:Database|name ]
                $[ let objectEntity = objectRelationship.to.entity ]
                $[ let objectPKColumnName = objectEntity.primaryKeyAttribute|domain:Database|name ]
                $[ let versionEntity = versionRelationship.to.entity ]
                $[ let versionPKColumnName = versionEntity.primaryKeyAttribute|domain:Database|name ]
    @Query(value =
        "SELECT ${unifiedFields} " +
          "FROM ${binderEntity|domain:Database|name} r " +
          "JOIN ${objectEntity|domain:Database|name} o ON r.${objectPKColumnName} = o.${objectPKColumnName} " +
          "JOIN ${versionEntity|domain:Database|name} v ON r.${versionPKColumnName} = v.${versionPKColumnName} " +
         "WHERE r.${topPKColumnName} = ?1 LIMIT ?3 OFFSET ?2", nativeQuery = true)
    List<Released${objectEntity.name}> getReleased${objectEntity.name}List(${topEntity.primaryKeyAttribute.type|language} ${topEntity.primaryKeyAttribute.name}, int offset, int limit);
            $[/ if ]
        $[/ if ]
    $[/ author ]
$[/ author ]